
@main("机构注册") {
    <script src="@routes.Assets.at("javascripts/routes-manager.js")"></script>
} {
	<div class="container-fluid content-bkg">
		<div class="container another-bkg">

			<!-- common step -->
			<div class="third-bkg" id='common-step'>
				<label style="font-size: 22px;" class="text-center">公司/厂家/专线 注册认证</label></br>

				<div style="margin:0; padding:0; width:100%; height:1px; background-color:#008bdc; overflow:hidden; margin-top:5px;"></div>

				<div class="form-horizontal" style="margin-top: 40px;">
					
					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="company-name" class="col-sm-2 control-label">企业全称</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name='company-name'>
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="business-license" class="col-sm-2 control-label">工商营业执照上传</label>
						<div class="col-sm-9 business-license-btn">
							<input id="register-business-image" type="file" multiple=true class="file-loading">
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="legal-person" class="col-sm-2 control-label">法定代表人</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name='legal-person'>
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="legal-person-id" class="col-sm-2 control-label">法定代表人身份证</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name='legal-person-id'>
						</div>
					</div>			  

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="road-license" class="col-sm-2 control-label">道路运输许可证上传</label>
						<div class="col-sm-9 road-license-btn">
							<input id="road-image" type="file" multiple=true class="file-loading">
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="company-reg-address" class="col-sm-2 control-label">企业注册地址</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name="reg-address" data-target="company-reg-address">
						</div>
					</div>	

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="company-phone-no" class="col-sm-2 control-label">企业办公电话</label>
						<div class="col-sm-2">
							<select class="form-control" disabled>
								<option value="china">中国大陆&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+86</option>
							</select>
						</div>
						<div class="col-sm-2">
							<input type="text" class="form-control" data-name="company-phone-dir" placeholder="区号">
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" data-name="company-phone-no" placeholder="电话号">
						</div>
						<div class="col-sm-2">
							<input type="text" class="form-control" data-name="company-phone-sep" placeholder="分机">
						</div>
					</div>			  		  

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="principal-name" class="col-sm-2 control-label">主要负责人姓名</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name="principal-name">
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="principal-phone-no" class="col-sm-2 control-label">主要负责人手机号码</label>
						<div class="col-sm-2">
							<select class="form-control" disabled>
								<option value="china">中国大陆&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+86</option>
							</select>
						</div>
						<div class="col-sm-7">
							<input type="text" class="form-control" data-name="cell-phone">
						</div>
					</div>

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="verifiable-code" class="col-sm-2 control-label" >动态验证码</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" data-name="code" placeholder="在此输入验证码" >
						</div>
						<div class="col-sm-2 verifiable-code-btn">
							<button type="button" class="btn" data-toggle="modal" data-target="verifiable-code-btn" onclick="sendCode()">获取动态验证码</button>
						</div>
					</div>		  

					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="certificate-type" class="col-sm-2 control-label" >认证类型</label>
						<div class="col-sm-9">
							<div class="checkbox">
								<label>
									<input name='company-type' type="radio" value=1> 物流公司
								</label>

								<label style="margin-left: 90px">
									<input name='company-type' type="radio" value=2> 厂家
								</label>

								<label style="margin-left: 90px">
									<input name='company-type' type="radio" value=3> 专线
								</label>
							</div>
						</div>
					</div>	  

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<div class="checkbox" style="text-align: center;">
								<label>
									<input type="checkbox" checked="true"><a href>注册视为认同《易聚货会员服务协议》</a>
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10 register-btn">
							<button type="submit" class="btn btn-lg" onclick="nextStep()">下一步</button>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10"></div>
					</div>

				</div>
			</div>

			<!-- company step -->
			<div class="third-bkg" id='company-step'>
				<label style="font-size: 22px; text-align: left;">公司注册认证</label></br>

				<div style="margin:0; padding:0; width:100%; height:1px; background-color:#008bdc; overflow:hidden; margin-top:5px;"></div>

				<div class="form-horizontal" style="margin-top: 40px;">
				
					<div class="form-group">
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="certificate-type" class="col-sm-2 control-label" >业务领域</label>

						<div class="col-sm-2 checkbox">
							<label>
								<input name="field" type="radio" value=0> 公路
							</label>
						</div>

						<div class="col-sm-2 checkbox">
							<label>
								<input name="field" type="radio" value=1> 铁路
							</label>
						</div>						

						<div class="col-sm-2 checkbox">
							<label>
								<input name="field" type="radio" value=2> 船运
							</label>
						</div>

						<div class="col-sm-2 checkbox">
							<label>
								<input name="field" type="radio" value=3> 航空
							</label>
						</div>							
						
					</div>				

					<div class="form-group" >
						<span class="glyphicon glyphicon-star col-sm-1 control-label"></span>
						<label for="principal-phone-no" class="col-sm-2 control-label">营业范围</label>
						<fieldset class="company-line-lst" >
							<div class="company-line" style="min-height: 40px !important">
								<div class="col-sm-2 col-sm-offset-1" style="padding-right: 0px !important">
									<select class="form-control" data-name="origin-province">
										<option selected disabled>请选择省区</option>
										<option value="浙江省">浙江省</option>
									</select>
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="origin-city">
										<option selected disabled>请选择市区</option>
										<option value="杭州市">杭州市</option>
									</select>
								</div>

								<div class="col-sm-1" style="text-align:center;">
									<img  src="@routes.Assets.at("images/arrow/oneway.png")" class="img-swap">
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="destination-province">
										<option selected disabled>请选择省区</option>
										<option value="浙江省">浙江省</option>
									</select>
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="destination-city">
										<option selected disabled>请选择市区</option>
										<option value="杭州市">杭州市</option>
									</select>
								</div>
								<button class="btn btn-sm btn-primary" style="margin-left: 5px !important" onclick="deleteRoute('company-line', $(this), 6)">删除</button> 
							</div>
						</fieldset>
					</div>	

					<div class="form-group">
					<span class="col-sm-1 control-label"></span>
						<label for="" class="col-sm-3 control-label"></label>
						<div class="col-sm-9 business-license-btn">
							<button data-name="company-line-add" onclick="addRoute('company-line', $(this), 6)" type="button" class="btn col-sm-7">新增主营路线</button>
						</div>
					</div>									

					<div class="form-group">
						<span class="col-sm-1 control-label"></span>
						<label for="company-name" class="col-sm-2 control-label">公司网站</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name="company-web">
						</div>
					</div>

					<div class="form-group">
						<span class="col-sm-1 control-label"></span>
						<label for="legal-person" class="col-sm-2 control-label">公司传真</label>
						<div class="col-sm-9">
							<input type="text" class="form-control" data-name="company-fax">
						</div>
					</div>

					<div class="form-group">
						<span class="col-sm-1 control-label"></span>
						<label for="legal-person-id" class="col-sm-2 control-label">公司邮箱</label>
						<div class="col-sm-9">
							<input type="email" class="form-control" data-name="company-email">
						</div>
					</div>			  


					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<div class="checkbox" style="text-align: center;">
								<label>
									<input type="checkbox" checked><a href>注册视为认同《易聚货会员服务协议》</a>
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10 register-btn">
							<button type="submit" class="btn btn-lg" onclick="register()">注册</button>
						</div>
					</div>

				</div>
			</div>

			<!-- indusry step -->
			<div class="third-bkg" id='industry-step'>
				<label style="font-size: 22px; text-align: left;">厂家注册认证</label></br>

				<div style="margin:0; padding:0; width:100%; height:1px; background-color:#008bdc; overflow:hidden; margin-top:5px;"></div>

				<div class="form-horizontal" style="margin-top: 40px;">								
				
					<div class="form-group">
						<label for="company-name" class="col-sm-2 control-label">公司网站</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="industry-web">
						</div>
					</div>

					<div class="form-group">
						<label for="legal-person" class="col-sm-2 control-label">公司传真</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="industry-fax">
						</div>
					</div>

					<div class="form-group">
						<label for="legal-person-id" class="col-sm-2 control-label">公司邮箱</label>
						<div class="col-sm-10">
							<input type="email" class="form-control" data-name="industry-email">
						</div>
					</div>			  


					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<div class="checkbox" style="text-align: center;">
								<label>
									<input type="checkbox" checked="true"><a href>注册视为认同《易聚货会员服务协议》</a>
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10 register-btn">
							<button class="btn btn-lg" onclick="register()">注册</button>
						</div>
					</div>
				</div>
			</div>

			<!-- spical step -->
			<div class="third-bkg" id='spical-step'>
				<label style="font-size: 22px; text-align: left;">专线注册认证</label></br>

				<div style="margin:0; padding:0; width:100%; height:1px; background-color:#008bdc; overflow:hidden; margin-top:5px;"></div>

				<div class="form-horizontal" style="margin-top: 40px;">			

					<div class="special-storage-list">
						<label for="principal-phone-no" class="col-sm-2 control-label">仓库地址</label>
						
						<div class="special-storage col-sm-offset-2"> 
							<div class="form-group">
								<div class="col-sm-2">
									<select class="form-control" data-name='province'>
										<option selected disabled>请选择省区</option>
										<option value="浙江省">浙江省</option>
									</select>
								</div>

								<div class="col-sm-2">
									<select class="form-control" data-name='city'>
										<option selected disabled>请选择市区</option>
										<option value="杭州市">杭州市</option>
									</select>
								</div>
							</div>

							<div class="form-group col-sm-11">
								<div class="col-sm-11">
									<textarea type="address" data-name='address' class="form-control" rows="3" placeholder="填写详细地址"></textarea>
								</div>
							</div>
							<button class="btn btn-sm btn-primary" style="margin-left: 5px !important" onclick="deleteRoute('special-storage', $(this), 5)">删除</button>
						</div>
					</div>

					<div class="form-group">
						<label for="" class="col-sm-3 control-label"></label>
						<div class="col-sm-10 business-license-btn">
							<button data-name="special-storage-add" type="button" class="btn col-sm-7" onclick="addRoute('special-storage', $(this), 5)">新增仓库地址</button>
						</div>
					</div>									
				
					<div class="form-group">
						<label for="principal-phone-no" class="col-sm-2 control-label">主营线路</label>

						<fieldset class="special-lines-lst" >
							<div class="special-line" style="min-height: 40px !important">
								<div class="col-sm-2 col-sm-offset-1" style="padding-right: 0px !important">
									<select class="form-control" data-name="origin-province">
										<option selected disabled>请选择省区</option>
										<option value="浙江省">浙江省</option>
									</select>
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="origin-city">
										<option selected disabled>请选择市区</option>
										<option value="杭州市">杭州市</option>
									</select>
								</div>

								<div class="col-sm-1" style="text-align:center; vertical-">
									<img  src="@routes.Assets.at("images/arrow/oneway.png")" class="img-swap">
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="destination-province">
										<option selected disabled>请选择省区</option>
										<option value="浙江省">浙江省</option>
									</select>
								</div>

								<div class="col-sm-2" style="padding-right: 0px !important">
									<select class="form-control" data-name="destination-city">
										<option selected disabled>请选择市区</option>
										<option value="杭州市">杭州市</option>
									</select>
								</div>
								<button class="btn btn-sm btn-primary" style="margin-left: 5px !important" onclick="deleteRoute('special-line', $(this), 5)">删除</button> 
							</div>
						</fieldset>

					</div>
				
					<div class="form-group">
						<label for="" class="col-sm-3 control-label"></label>
						<div class="col-sm-10 business-license-btn">
							<button  data-name="special-line-add" type="button" class="btn col-sm-7" onclick="addRoute('special-line', $(this), 5)">新增主营路线</button>
						</div>
					</div>

					<div class="form-group">

						<label for="certificate-type" class="col-sm-2 control-label" >发车时效</label>

						<div class="col-sm-3 radio">
							<label>
								<input name="occation" type="radio" value="0"> 天天发车
							</label>
						</div>

						<div class="col-sm-3 radio">
							<label>
								<input name="occation" type="radio" value="1"> 隔天发车
							</label>
						</div>						
						
					</div>	

					<div class="form-group">

						<label for="certificate-type" class="col-sm-2 control-label" >拥有车型</label>

						<div class="col-sm-10">
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="平板车"> 平板车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="高栏车"> 高栏车
								</label>
							</div>						
							
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="厢式车"> 厢式车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="保温冷藏"> 保温冷藏
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="半挂车"> 半挂车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="危险品车"> 危险品车
								</label>
							</div>						
							
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="高地板"> 高低板
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="起重车"> 起重车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="牵引车"> 牵引车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="仓棚车"> 仓棚车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="罐式车"> 罐式车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="特种车"> 特种车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="集装箱车"> 集装箱车
								</label>
							</div>	
						</div>
					</div>	

					<div class="form-group">
						<label for="company-name" class="col-sm-2 control-label">公司网站</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="specialway-web">
						</div>
					</div>



					<div class="form-group">
						<label for="legal-person" class="col-sm-2 control-label">公司传真</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="specialway-fax">
						</div>
					</div>

					<div class="form-group">
						<label for="legal-person-id" class="col-sm-2 control-label">公司邮箱</label>
						<div class="col-sm-10">
							<input type="email" class="form-control" data-name="specialway-email">
						</div>
					</div>			  


					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<div class="checkbox" style="text-align: center;">
								<label>
									<input type="checkbox" checked="true"><a href>注册视为认同《易聚货会员服务协议》</a>
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10 register-btn">
							<button class="btn btn-lg" onclick="register()">注册</button>
						</div>
					</div>

				</div>

			</div>
		</div>
	</div>
} {
	<script type="text/javascript">
		var query_object;

		$(function(){
			$('#company-step').hide();
			$('#industry-step').hide();
			$('#spical-step').hide();
		});

		/**swap image one way & two way**/
        
        $(".img-swap").click(function(){
            var src = ($(this).attr("src") == "@routes.Assets.at("images/arrow/oneway.png")")
                    ?"@routes.Assets.at("images/arrow/twoway.png")"
                    :"@routes.Assets.at("images/arrow/oneway.png")";
            $(this).attr("src", src);
        });

		/** 工商营业执照图片上传**/
		var register_business_image = new fileUpload($("#register-business-image"));
		/** 道路许可证图片上传**/
		var road_image = new fileUpload($("#road-image"));

		function validate(ele, result) {
			if (result) $(ele).removeClass('validate-error');
			else $(ele).addClass('validate-error');
			return result;
		}

		function nextStep() {
			var result = getIndexInfo();
			if (!result) {
				return;
			};

			var t = $('input[name="company-type"]:checked').val();
			$('#common-step').hide();
			if (t == 1) {
				$('#company-step').show();
			} else if (t == 2) {
				$('#industry-step').show();
			} else if (t == 3) {
				$('#spical-step').show();
			}
		} 

		function getIndexInfo() {
			var result = true;

/**
			var company_name = $('input[data-name="company-name"]').val();
			result &= validate($('input[data-name="company-name"]'), hasInput(company_name));

			var legal_person = $('input[data-name="legal-person"]').val();
			result &= validate($('input[data-name="legal-person"]'), hasInput(legal_person));

			var legal_person_id = $('input[data-name="legal-person-id"]').val();
			result &= validate($('input[data-name="legal-person-id"]'), hasInput(legal_person_id));

			var company_reg_address = $('input[data-name="reg-address"]').val();
			result &= validate($('input[data-name="reg-address"]'), hasInput(company_reg_address));

			var company_phone_dir = $('input[data-name="company-phone-dir"]').val();
			var company_phone_no = $('input[data-name="company-phone-no"]').val();
			var company_phone_sep = $('input[data-name="company-phone-sep"]').val();

**/

			var company_name = $('input[data-name="company-name"]').val();
			var regCompName = /([\u4e00-\u9fa5a]+)|([a-zA-z'. ]*)/; 
			if (company_name.length == 0){ 
		        alert("必须输入企业名字");  
		        return false; 
		    } else if(regCompName.test(company_name) === false) {
		    	alert("不要乱造公司名字！");
		    	return false;
		    }


			var legal_person = $('input[data-name="legal-person"]').val();
			var regNameL = /[\u4E00-\u9FA5]{2,5}(?:·[\u4E00-\u9FA5]{2,5})*/; 
			if (legal_person.length == 0){ 
		        alert("必须输入姓名");  
		        return false; 
		    } else if(regNameL.test(legal_person) === false) {
		    	alert("你的名字不对！写中文名！别乱打！");
		    	return false;
		    }


			var legal_person_id = $('input[data-name="legal-person-id"]').val();
			var regIDL = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
			if (legal_person_id.length == 0){ 
		        alert("必须输入身份证号码");  
		        return false; 
		    } else if(regIDL.test(legal_person_id) === false) {
		    	alert("身份证号码不对！");
		    	return false;
		    }

			var company_reg_address = $('input[data-name="reg-address"]').val();
			var regCPAD = /^[0-9]*$/;
			var regCPADD =/^[A-Za-z]+$/;
			if(company_reg_address.length == 0){
				alert("必须输入地址");
				return false;
			} else if(regCPAD.test(company_reg_address) === true) {
				alert("地址输入有误");
				return false;
			} else if(regCPADD.test(company_reg_address) === true) {
				alert("地址输入有误");
				return false;
			}


			var company_phone_dir = $('input[data-name="company-phone-dir"]').val();
			var regIDLD = /^[0-9]*$/; 
			if(regIDLD.test(company_phone_dir) === false) {
		    	alert("区号需要是数字");
		    	return false;
		    }


			var company_phone_no = $('input[data-name="company-phone-no"]').val();
			if (company_phone_no.length == 0){ 
		        alert("必须输入公司电话");  
		        return false; 
		    } 
		    // else if(!(/^1[3|4|5|7|8]\d{9}$/.test(company_phone_no))) {
		    // 	alert("公司电话不对！");
		    // 	return false;
		    // }
			
			var company_phone_sep = $('input[data-name="company-phone-sep"]').val();
			var regIDLDS = /^[0-9]*$/; 
			if(regIDLDS.test(company_phone_dir) === false) {
		    	alert("区号需要是数字");
		    	return false;
		    }

			var company_type = $('input[name="company-type"]:checked').val();
			result &= validate($('input[name="company-type"]'), (typeof(company_type) != "undefined"));

			var business_images = register_business_image.queryFileNames();
			if (business_images.length != 1) {
				alert("请上传并仅仅上传一张图片");
				result &= false;
			}

			var road_image_arr = road_image.queryFileNames();
			if (road_image_arr.length != 1) {
				alert("请上传并仅仅上传一张图片");
				result &= false;
			}

			var cell_phone = $('input[data-name="cell-phone"]').val();
			if (cell_phone.length == 0){ 
		        alert("必须输入手机号");  
		        return false; 
		    } else if(!(/^1[3|4|5|7|8]\d{9}$/.test(cell_phone))) {
		    	alert("手机号不对！");
		    	return false;
		    }

/**			
			result &= validate($('input[data-name="cell-phone"]'), hasInput(cell_phone));
**/
			var code = $('input[data-name="code"]').val();
			result &= validate($('input[data-name="code"]'), hasInput(code));

			if (Boolean(result)) {
				query_object = new Object();
				query_object['company_type'] = Number(company_type);
        		query_object['company_name'] = company_name;
        		query_object['legal_person'] = legal_person;
        		query_object['legal_person_id'] = legal_person_id;
        		query_object['address'] = company_reg_address;
        		query_object['phone_dir'] = company_phone_dir;
        		query_object['phone_no'] = company_phone_no;
        		query_object['phone_sep'] = company_phone_sep;
        		query_object['business_image'] = business_images[0];
        		query_object['road_image'] = road_image_arr[0];
        		query_object['cell_phone'] = cell_phone;
        		query_object['code'] = code;
			}

			return Boolean(result);
		}

		function getCompanylines() {
			var result = true;
			var lines_lst = [];
			$.each($('.company-line'), function( index, value ) {
				var origin_province = $(this).find('select[data-name="origin-province"]').val();
				result &= validate($(this).find('select[data-name="origin-province"]'), (typeof(origin_province) != "undefined"));

				var origin_city = $(this).find('select[data-name="origin-city"]').val();
				result &= validate($(this).find('select[data-name="origin-city"]'), (typeof(origin_city) != "undefined"));

				var destination_province = $(this).find('select[data-name="destination-province"]').val();
				result &= validate($(this).find('select[data-name="destination-province"]'), (typeof(destination_province) != "undefined"));

				var destination_city = $(this).find('select[data-name="destination-city"]').val();
				result &= validate($(this).find('select[data-name="destination-city"]'), (typeof(destination_city) != "undefined"));		

				if (Boolean(result)) {
					var tmp = new Object();
					tmp['origin_province'] = origin_province;
					tmp['origin_city'] = origin_city;
					tmp['destination_province'] = destination_province;
					tmp['destination_city'] = destination_city;

					lines_lst.push(tmp);
				};
			});
			query_object['company_lines'] = lines_lst;
			return Boolean(result);
		}

		function getCompanyInfo() {
			var result = true;
			var company_field = $('input[name="field"]:checked').val();
			result &= validate($('input[name="field"]'), (typeof(company_field) != "undefined"));

			result &= getCompanylines();

			var company_web = $('input[data-name="company-web"]').val();

			var company_fax = $('input[data-name="company-fax"]').val();

			var company_email = $('input[data-name="company-email"]').val();	 

/*
			result &= validate($('input[data-name="company-email"]'), hasInput(company_email));
*/
			if (Boolean(result)) {
				query_object['company_business'] = Number(company_field);
				query_object['company_web'] = company_web;
				query_object['company_fax'] = company_fax;
				query_object['company_email'] = company_email;
			}

			return Boolean(result);
		}

		function getIndustryInfo() {
			var result = true;
			var industry_web = $('input[data-name="industry-web"]').val();
			var industry_fax = $('input[data-name="industry-fax"]').val();
			var industry_email = $('input[data-name="industry-email"]').val();

/**			
			result &= validate($('input[data-name="industry-email"]'), hasInput(industry_email));
**/
			if (Boolean(result)) {
				query_object['industry_web'] = industry_web;
				query_object['industry_fax'] = industry_fax;
				query_object['industry_email'] = industry_email;
			}

			return Boolean(result);
		}

		function getSpecialwaylines() {
			var result = true;
			var lines_lst = [];
			$.each($('.special-line'), function( index, value ) {
				var origin_province = $(this).find('select[data-name="origin-province"]').val();
				result &= validate($(this).find('select[data-name="origin-province"]'), (typeof(origin_province) != "undefined"));

				var origin_city = $(this).find('select[data-name="origin-city"]').val();
				result &= validate($(this).find('select[data-name="origin-city"]'), (typeof(origin_city) != "undefined"));

				var destination_province = $(this).find('select[data-name="destination-province"]').val();
				result &= validate($(this).find('select[data-name="destination-province"]'), (typeof(destination_province) != "undefined"));

				var destination_city = $(this).find('select[data-name="destination-city"]').val();
				result &= validate($(this).find('select[data-name="destination-city"]'), (typeof(destination_city) != "undefined"));		

				if (Boolean(result)) {
					var tmp = new Object();
					tmp['origin_province'] = origin_province;
					tmp['origin_city'] = origin_city;
					tmp['destination_province'] = destination_province;
					tmp['destination_city'] = destination_city;

					lines_lst.push(tmp);
				};
			});
			query_object['special_lines'] = lines_lst;
			return Boolean(result);
		}

		function getSpecialwayStorage() {
			var result = true;
			var storage_lst = [];
			$.each($('.special-storage'), function( index, value ) {
				var province = $(this).find('select[data-name="province"]').val();
				result &= validate($(this).find('select[name="province"]'), (typeof(province) != "undefined"));

				var city = $(this).find('select[data-name="city"]').val();
				result &= validate($(this).find('select[name="city"]'), (typeof(city) != "undefined"));

				var address = $(this).find('textarea[data-name="address"]').val();
				result &= validate($(this).find('select[name="city"]'), hasInput(address));

				if (Boolean(result)) {
					var tmp = new Object();
					tmp['province'] = province;
					tmp['city'] = city;
					tmp['address'] = address;

					storage_lst.push(tmp);
				};
			});
			query_object['special_storage'] = storage_lst;
			return Boolean(result);
		}

		function getSpecialwayVehicle() {
			var result = true;
			var vehicle_lst = [];
			$.each($('input[name="vehicle"]:checked'), function(index, value){
				vehicle_lst.push($(this).val());
			});
			result &= validate($('input[name="vehicle"]'), vehicle_lst.length > 0)

			query_object['vehicle'] = vehicle_lst;
			return Boolean(result);
		}

		function getSpecialwayInfo() {
			var result = true;

			var special_occation = $('input[name="occation"]:checked').val();
			result &= validate($('input[name="occation"]'), (typeof(special_occation) != "undefined"));

			result &= getSpecialwayStorage();
			result &= getSpecialwaylines();
			result &= getSpecialwayVehicle();

			var special_web = $('input[data-name="specialway-web"]').val();
			var special_fax = $('input[data-name="specialway-fax"]').val();

			var special_email = $('input[data-name="specialway-email"]').val();

/**
			result &= validate($('input[data-name="specialway-email"]'), hasInput(special_email));
			**/
			if (Boolean(result)) {
				query_object['special_occation'] = Number(special_occation)
				query_object['special_web'] = special_web;
				query_object['special_fax'] = special_fax;
				query_object['special_email'] = special_email;
			}

			return Boolean(result);
		}

		function hasInput(str) {
			var result = (typeof(str) == "string") && (str != "");
			return result;
		}

		function register() {
			var t = $('input[name="company-type"]:checked').val();
			// $('#common-step').hide();
			var result;
			if (t == 1) {
				result = getCompanyInfo();
			} else if (t == 2) {
				result = getIndustryInfo();
			} else if (t == 3) {
				result = getSpecialwayInfo();
			}

			if (!result) return;

			$.ajax({
	            url: "/auth/register",
	            type: 'POST',
	            dataType: 'json',
	            contentType: 'application/json, charset=utf-8',
	            data: JSON.stringify(query_object),
	            cache: false,
	            success: function (data) {
	                if (data.status == "ok") {                                          
	                     alert("注册成功审核！");
	                     location.href = "/register/complete";
	                } else {
	                    alert(data.error.message);
	                }
	            },
	            error: function (xhr, status, error) {
	                alert("请检查您的输入");
	            }
	        });
		}

		function sendCode() {
			var cell_phone = $('input[data-name="cell-phone"]').val();

			var tmp = new Object();
			tmp['cell_phone'] = cell_phone;

			$.ajax({
	            url: "/auth/send/code",
	            type: 'POST',
	            dataType: 'json',
	            contentType: 'application/json, charset=utf-8',
	            data: JSON.stringify(tmp),
	            cache: false,
	            success: function (data) {
	                if (data.status == "ok") {                                          
	                     alert("发送成功");
	                } else {
	                    alert(data.error.message);
	                }
	            },
	            error: function (xhr, status, error) {
	                alert("请检查您的输入");
	            }
	        });
		}

	</script>
}
