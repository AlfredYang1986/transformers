@(message: String)

@main("驾驶员注册") {
    
} {
	<div class="container-fluid content-bkg">
		<div class="container another-bkg">
			<div class="third-bkg">

				<label style="font-size: 36px; text-align: left;">驾驶员</label>
				<label style="font-size: 18px; text-align: center;">注册认证</label> </br>

				<div style="margin:0; padding:0; width:100%; height:1px; background-color:#008bdc; overflow:hidden; margin-top:5px;"></div>

				<div class="form-horizontal" style="margin-top: 40px;">
				
					<div class="form-group">
						<label for="company-name" class="col-sm-2 control-label">姓名</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="driver-name">
						</div>
					</div>

					<div class="form-group">
						<label for="legal-person" class="col-sm-2 control-label">身份证号码</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="driver-secial-id">
						</div>
					</div>

					<div class="form-group">
						<label for="business-license" class="col-sm-2 control-label">驾驶员行驶证</label>
						<div class="col-sm-10 business-license-btn">
							<button type="button" class="btn" data-toggle="modal" data-target="#driver-license-image">上传照片</button>
						</div>
					</div>
					<!-- driver image upload-->
					<div class="modal fade" id="driver-license-image" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
							<div class="modal-header home-login-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								<i><img src="@routes.Assets.at("images/homePage/register-close-icon.png")"></i>
								</button>
								<h3 class="modal-title" style="text-align:center" id="myModalLabel">					
								驾驶员行驶证上传
								</h3>
							</div>

							<div class="modal-body">
								<input id="driver-image-upload" name="driver-image-upload[]" type="file" multiple=true class="file-loading">
							</div>

							</div><!-- /.modal-content -->
						</div><!-- /.modal -->
					</div>

					<div class="form-group">
						<label for="business-license" class="col-sm-2 control-label">驾驶员驾驶证</label>
						<div class="col-sm-10 business-license-btn">
							<button type="button" class="btn" data-toggle="modal" data-target="#drivering-image">上传照片</button>
						</div>
					</div>

					<!-- driver image upload-->
					<div class="modal fade" id="drivering-image" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
							<div class="modal-header home-login-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								<i><img src="@routes.Assets.at("images/homePage/register-close-icon.png")"></i>
								</button>
								<h3 class="modal-title" style="text-align:center" id="myModalLabel">					
								驾驶员驾驶证上传
								</h3>
							</div>

							<div class="modal-body">
								<input id="driver-road-image" name="driver-road-image" type="file" multiple=true class="file-loading">
							</div>

							</div><!-- /.modal-content -->
						</div><!-- /.modal -->
					</div>
					<div class="form-group">
						<label for="principal-phone-no" class="col-sm-2 control-label">手机号码</label>
						<div class="col-sm-2">
							<select class="form-control" disabled>
								<option value="china">中国大陆&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+86</option>
							</select>
						</div>
						<div class="col-sm-8">
							<input type="text" class="form-control" data-name="phone-no">
						</div>
					</div>

					<div class="form-group">
						<label for="verifiable-code" class="col-sm-2 control-label" >动态验证码</label>
						<div class="col-sm-8">
							<input type="email" class="form-control" data-name="phone-code" placeholder="在此输入验证码" >
						</div>
						<div class="col-sm-2 verifiable-code-btn">
							<button type="button" class="btn" data-toggle="modal" data-target="verifiable-code-btn">获取动态验证码</button>
						</div>
					</div>

					<div class="form-group">

						<label for="certificate-type" class="col-sm-2 control-label" >拥有车型</label>

						<div class="col-sm-10">
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="平板车"> 平板车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="高栏车"> 高栏车
								</label>
							</div>						
							
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="厢式车"> 厢式车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="保温冷藏"> 保温冷藏
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="半挂车"> 半挂车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="危险品车"> 危险品车
								</label>
							</div>						
							
							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="高地板"> 高低板
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="起重车"> 起重车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="牵引车"> 牵引车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="仓棚车"> 仓棚车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="罐式车"> 罐式车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="特种车"> 特种车
								</label>
							</div>

							<div class="col-sm-2 checkbox">
								<label>
									<input name="vehicle" type="checkbox" value="集装箱车"> 集装箱车
								</label>
							</div>	
						</div>
					</div>	

					<div class="form-group">
						<label for="legal-person" class="col-sm-2 control-label">载重</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="capacity">
						</div>
					</div>

					<div class="form-group">
						<label for="legal-person-id" class="col-sm-2 control-label">车长</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" data-name="vehicle-length">
						</div>
					</div>			  

					<div class="form-group">
						<label for="principal-phone-no" class="col-sm-2 control-label">常用路线</label>
						<div class="driver-line">
							<div class="col-sm-2">
								<select class="form-control" data-name="origin-province">
									<option selected disabled>请选择省区</option>
									<option value="浙江省">浙江省</option>
								</select>
							</div>

							<div class="col-sm-2">
								<select class="form-control" data-name="origin-city">
									<option selected disabled>请选择市区</option>
									<option value="杭州市">杭州市</option>
								</select>
							</div>

							<div class="col-sm-1" style="text-align:center;">
								<img  src="@routes.Assets.at("images/arrow/oneway.png")">
							</div>

							<div class="col-sm-2">
								<select class="form-control" data-name="destination-province">
									<option selected disabled>请选择省区</option>
									<option value="浙江省">浙江省</option>
								</select>
							</div>

							<div class="col-sm-2">
								<select class="form-control" data-name="destination-city">
									<option selected disabled>请选择市区</option>
									<option value="杭州市">杭州市</option>
								</select>
							</div>
						</div>
					</div>		

					<div class="form-group">
						<label for="" class="col-sm-2 control-label"></label>
						<div class="col-sm-10 business-license-btn">
							<button type="button" class="btn" data-toggle="modal" data-target="newroute">常用路线添加</button>
						</div>
					</div>	

					<div class="form-group">
						<label for="certificate-type" class="col-sm-2 control-label" >是否购买货物险</label>
						<div class="col-sm-10">
							<div class="radio">
								<label>
									<input type="radio" name="insurance" value="1"> 已购买
								</label>

								<label style="margin-left: 90px">
									<input type="radio" name="insurance" value="0"> 未购买
								</label>

							</div>
						</div>
					</div>	  

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<div class="checkbox" style="text-align: center;">
								<label>
									<input type="checkbox" checked="true"><a href>注册视为认同《易聚货会员服务协议》</a>
								</label>
							</div>
						</div>
					</div>

					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10 register-btn">
							<button class="btn btn-lg" onclick="register()">注册</button>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
} {
	<script type="text/javascript">
	/**
		only one type of certification can be selected
	**/
		// $('input[type="radio"]').on('change', function() {
		//    $('input[type="radio"]').not(this).prop('checked', false);
		// });
		var query_object;

		$(function(){

		});

		/** 驾驶员行驶证图片上传**/
	    $("#driver-image-upload").fileinput({
		    uploadUrl: "/file-upload-batch/2",
		    allowedFileExtensions: ["jpg", "png", "gif"],
		    minImageWidth: 50,
		    minImageHeight: 50
    	});

	    /** 驾驶员驾驶证图片上传**/
	    $("#driver-road-image").fileinput({
		    uploadUrl: "/file-upload-batch/2",
		    allowedFileExtensions: ["jpg", "png", "gif"],
		    minImageWidth: 50,
		    minImageHeight: 50
    	});

		function hasInput(str) {
			var result = (typeof(str) == "string") && (str != "");
			return result;
		}

		function validate(ele, result) {
			if (result) $(ele).removeClass('validate-error');
			else $(ele).addClass('validate-error');
			return result;
		}

		function validate_number(ele, value) {
			var tmp = Number(value);
			var result = typeof(tmp) != "undefined";
			if (result) $(ele).removeClass('validate-error');
			else $(ele).addClass('validate-error');
			return result;
		}

		function getDriverCommonInfo() {
			var result = true;
			var driver_name = $('input[data-name="driver-name"]').val();
			result &= validate($('input[data-name="driver-name"]'), hasInput(driver_name));

			var driver_secial_id = $('input[data-name="driver-secial-id"]').val();
			result &= validate($('input[data-name="driver-secial-id"]'), hasInput(driver_secial_id));

			var driver_phone_no = $('input[data-name="phone-no"]').val();
			result &= validate($('input[data-name="phone-no"]'), hasInput(driver_phone_no));
			result &= validate_number($('input[data-name="phone-no"]'), driver_phone_no);

			var driver_capacity = $('input[data-name="capacity"]').val();
			result &= validate($('input[data-name="capacity"]'), hasInput(driver_capacity));
			result &= validate_number($('input[data-name="capacity"]'), driver_capacity);

			var driver_vehicle_length = $('input[data-name="vehicle-length"]').val();
			result &= validate($('input[data-name="vehicle-length"]'), hasInput(driver_vehicle_length));
			result &= validate_number($('input[data-name="vehicle-length"]'), driver_phone_no);

			var driver_insurance = $('input[name="insurance"]:checked').val();
			result &= validate($('input[name="insurance"]'), (typeof(driver_insurance) != "undefined"));

			if (Boolean(result)) {
				query_object = new Object();
				query_object['driver_name'] = driver_name;
				query_object['driver_secial_id'] = driver_secial_id;
				query_object['phone_no'] = driver_phone_no;
				query_object['capacity'] = Number(driver_capacity);
				query_object['vehicle_length'] = Number(driver_vehicle_length);
				query_object['insurance'] = Number(driver_insurance);
			};

			return Boolean(result);
		}

		function getDriverVehicle() {
			var result = true;
			var vehicle_lst = [];
			$.each($('input[name="vehicle"]:checked'), function(index, value){
				vehicle_lst.push($(this).val());
			});
			result &= validate($('input[name="vehicle"]'), vehicle_lst.length > 0)

			query_object['vehicle'] = vehicle_lst;
			return Boolean(result);
		}

		function getDriverLines() {
			var result = true;
			var lines_lst = [];
			$.each($('.driver-line'), function( index, value ) {
				var origin_province = $(this).find('select[data-name="origin-province"]').val();
				result &= validate($(this).find('select[name="origin-province"]'), (typeof(origin_province) != "undefined"));

				var origin_city = $(this).find('select[data-name="origin-city"]').val();
				result &= validate($(this).find('select[name="origin-city"]'), (typeof(origin_city) != "undefined"));

				var destination_province = $(this).find('select[data-name="destination-province"]').val();
				result &= validate($(this).find('select[name="destination_province"]'), (typeof(destination_province) != "undefined"));

				var destination_city = $(this).find('select[data-name="destination-city"]').val();
				result &= validate($(this).find('select[name="destination_city"]'), (typeof(destination_city) != "undefined"));		

				if (Boolean(result)) {
					var tmp = new Object();
					tmp['origin_province'] = origin_province;
					tmp['origin_city'] = origin_city;
					tmp['destination_province'] = destination_province;
					tmp['destination_city'] = destination_city;

					lines_lst.push(tmp);
				};
			});
			query_object['driver_lines'] = lines_lst;
			return Boolean(result);
		}

		function register() {
			var result = getDriverCommonInfo();
			result &= getDriverLines();
			result &= getDriverVehicle();

			if (Boolean(result)) { 
				$.ajax({
		            url: "/auth/driver/register",
		            type: 'POST',
		            dataType: 'json',
		            contentType: 'application/json, charset=utf-8',
		            data: JSON.stringify(query_object),
		            cache: false,
		            success: function (data) {
		                if (data.status == "ok") {                                          
		                     alert("注册成功审核！");
		                     location.href = "/register/complete";
		                } else {
		                    alert(data.error.message);
		                }
		            },
		            error: function (xhr, status, error) {
		                alert("请检查您的输入");
		            }
		        });
			}
		}

	</script>
}
